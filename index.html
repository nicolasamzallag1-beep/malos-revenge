<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <meta http-equiv="Content-Style-Type" content="text/css">
  <title></title>
  <meta name="Generator" content="Cocoa HTML Writer">
  <meta name="CocoaVersion" content="2685.2">
  <style type="text/css">
    p.p1 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica}
    p.p2 {margin: 0.0px 0.0px 0.0px 0.0px; font: 12.0px Helvetica; min-height: 14.0px}
  </style>
</head>
<body>
<p class="p1">&lt;!DOCTYPE html&gt;</p>
<p class="p1">&lt;html lang="fr"&gt;</p>
<p class="p1">&lt;head&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta charset="UTF-8" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;meta name="viewport" content="width=device-width, initial-scale=1.0" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;title&gt;Malo's Revenge â€” ApÃ©ro Arena ğŸ·&lt;/title&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;link rel="preconnect" href="https://fonts.googleapis.com" /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;link rel="preconnect" href="https://fonts.gstatic.com" crossorigin /&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;link href="https://fonts.googleapis.com/css2?family=Oxanium:wght@400;600;700;800&amp;display=swap" rel="stylesheet" /&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;style&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>:root{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--bg1:#0b1020;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--bg2:#141a33;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--neon:#7c3aed;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--neon2:#22d3ee;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--gold:#fbbf24;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--good:#34d399;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--bad:#fb7185;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--glass: rgba(255,255,255,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--glass2: rgba(255,255,255,.14);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--stroke: rgba(255,255,255,.14);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>--shadow: rgba(0,0,0,.45);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>*{ box-sizing:border-box; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>html, body{ height:100%; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: "Oxanium", system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: radial-gradient(1200px 900px at 30% 20%, rgba(124,58,237,.28), transparent 55%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>radial-gradient(1000px 800px at 80% 60%, rgba(34,211,238,.22), transparent 50%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>linear-gradient(180deg, var(--bg1), var(--bg2));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color:#fff;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>user-select:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>cursor: crosshair;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* subtle animated grain */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>body::before{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>content:"";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:fixed;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radial-gradient(circle at 20% 10%, rgba(255,255,255,.06), transparent 30%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radial-gradient(circle at 70% 40%, rgba(255,255,255,.05), transparent 28%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radial-gradient(circle at 40% 80%, rgba(255,255,255,.04), transparent 25%);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>mix-blend-mode: overlay;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opacity:.55;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>animation: drift 8s ease-in-out infinite;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes drift{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0%,100%{ transform: translate3d(0,0,0) scale(1); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>50%{ transform: translate3d(-12px,10px,0) scale(1.02); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#game{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:relative;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>width:100vw;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>height:100vh;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>width:100%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>height:100%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* HUD */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#hud{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:18px 18px auto 18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap:12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:flex-start;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:30;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hudCard{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:auto;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--stroke);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 10px 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>min-width: 140px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 18px 40px var(--shadow);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(14px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hudLabel{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 11px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing: .14em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(255,255,255,.75);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-bottom:4px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hudValue{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 26px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>line-height:1.05;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-shadow: 0 0 18px rgba(255,255,255,.18);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#hudScore .hudValue{ color: var(--gold); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#hudTime .hudValue{ color: var(--good); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#hudHits .hudValue{ color: var(--neon2); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#topRight{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>top:18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>right:18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:31;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap:10px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: "Oxanium", sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.08em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid var(--stroke);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(255,255,255,.14), rgba(255,255,255,.06));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 10px 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>cursor:pointer;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transition: transform .15s ease, background .15s ease, border-color .15s ease;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 14px 34px var(--shadow);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(14px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn:hover{ transform: translateY(-2px); border-color: rgba(255,255,255,.25); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.btn:active{ transform: translateY(0); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Start overlay */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#start{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>flex-direction:column;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>justify-content:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap:16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:50;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radial-gradient(900px 650px at 50% 35%, rgba(124,58,237,.35), transparent 55%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>radial-gradient(800px 600px at 65% 65%, rgba(34,211,238,.22), transparent 55%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>linear-gradient(180deg, rgba(10,14,30,.65), rgba(10,14,30,.88));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(14px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.title{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: clamp(34px, 6vw, 70px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing: .06em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>line-height:1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-align:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-shadow:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 0 28px rgba(124,58,237,.35),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 0 24px rgba(34,211,238,.22),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 16px 60px rgba(0,0,0,.55);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.badge{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:inline-flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap:10px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 10px 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 999px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid var(--stroke);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(14px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 18px 42px var(--shadow);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(255,255,255,.9);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:700;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.08em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-transform: uppercase;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.panel{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>width:min(860px, calc(100vw - 32px));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 22px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid rgba(255,255,255,.16);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(255,255,255,.12), rgba(255,255,255,.06));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 28px 70px rgba(0,0,0,.55);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(16px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.grid{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:grid;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>grid-template-columns: repeat(4, 1fr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.diff{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>cursor:pointer;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 18px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 14px 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color:#fff;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-align:left;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(135deg, rgba(255,255,255,.12), rgba(255,255,255,.06));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid rgba(255,255,255,.16);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transition: transform .15s ease, border-color .15s ease, box-shadow .15s ease;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 18px 46px rgba(0,0,0,.45);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:relative;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-family: "Oxanium", sans-serif;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.diff::before{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>content:"";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:-2px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: radial-gradient(500px 220px at 30% 20%, rgba(34,211,238,.28), transparent 55%),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  Â  </span>radial-gradient(420px 220px at 90% 80%, rgba(124,58,237,.32), transparent 55%);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opacity:.8;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.diff:hover{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transform: translateY(-3px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-color: rgba(255,255,255,.28);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 26px 64px rgba(0,0,0,.55);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.diffName{ position:relative; z-index:1; font-weight:800; letter-spacing:.1em; text-transform:uppercase; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.diffDesc{ position:relative; z-index:1; margin-top:6px; color: rgba(255,255,255,.78); font-weight:600; font-size:13px; line-height:1.3; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hint{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: rgba(255,255,255,.75);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:600;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>line-height:1.55;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-align:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 14px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.kbd{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:inline-flex;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>justify-content:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 2px 8px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 8px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border:1px solid rgba(255,255,255,.18);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: rgba(0,0,0,.25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.06em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin: 0 3px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* End overlay */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#end{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>flex-direction:column;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>align-items:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>justify-content:center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gap:16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:60;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: linear-gradient(180deg, rgba(10,14,30,.78), rgba(10,14,30,.92));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>backdrop-filter: blur(16px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.endTitle{ font-size: clamp(28px, 5vw, 54px); font-weight: 900; letter-spacing:.06em; margin:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.endScore{ font-size: clamp(20px, 4vw, 34px); font-weight: 800; color: var(--gold); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.endMsg{ max-width: 860px; padding: 0 18px; text-align:center; color: rgba(255,255,255,.88); font-weight: 600; line-height:1.75; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Floating hit bubble (anchored near target, clamped inside viewport) */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hitBubble{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:80;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>max-width: min(360px, calc(100vw - 16px));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>padding: 10px 12px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-radius: 16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: rgba(255,255,255,.92);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: #0b1020;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 800;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>box-shadow: 0 18px 50px rgba(0,0,0,.45);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border: 1px solid rgba(0,0,0,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transform-origin: left center;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>animation: pop .18s ease-out;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hitBubble small{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>display:block;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>margin-top:4px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight:700;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opacity:.75;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.04em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes pop{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>from{ transform: translate3d(0,6px,0) scale(.92); opacity:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>to{ transform: translate3d(0,0,0) scale(1); opacity:1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* little arrow */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hitBubble::after{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>content:"";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>width: 10px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>height: 10px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>background: rgba(255,255,255,.92);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>left: -5px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>top: 16px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transform: rotate(45deg);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-left: 1px solid rgba(0,0,0,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-bottom: 1px solid rgba(0,0,0,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* tweak arrow when bubble is on the left */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.hitBubble.leftSide::after{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>left: auto;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>right: -5px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transform: rotate(225deg);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-left: none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-bottom: none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-right: 1px solid rgba(0,0,0,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>border-top: 1px solid rgba(0,0,0,.08);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Combo banner */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#combo{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>left:50%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>top:50%;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>transform: translate(-50%,-50%);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: clamp(34px, 6vw, 72px);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-weight: 900;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>letter-spacing:.06em;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>color: #fff;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-shadow:</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 0 26px rgba(34,211,238,.35),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 0 32px rgba(124,58,237,.32),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>0 20px 70px rgba(0,0,0,.7);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opacity:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:40;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#combo.show{ animation: combo .9s ease-out forwards; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes combo{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0%{ opacity:0; transform: translate(-50%,-50%) scale(.75) rotate(-6deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>20%{ opacity:1; transform: translate(-50%,-50%) scale(1.1) rotate(2deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>70%{ opacity:1; transform: translate(-50%,-50%) scale(1.02) rotate(-1deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>100%{ opacity:0; transform: translate(-50%,-50%) scale(.9) rotate(0deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Floating wine glasses animation */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.floaters{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>inset:0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:55;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>overflow:hidden;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.floater{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 34px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>opacity:.28;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>filter: drop-shadow(0 12px 24px rgba(0,0,0,.35));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>animation: floatUp var(--dur, 10s) linear infinite;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes floatUp{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0%{ transform: translate3d(0, 110vh, 0) rotate(0deg) scale(var(--s,1)); opacity:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>10%{ opacity: var(--o,.28); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>90%{ opacity: var(--o,.28); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>100%{ transform: translate3d(0, -140px, 0) rotate(360deg) scale(var(--s,1)); opacity:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Mobile adjustments */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@media (max-width: 900px){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>.grid{ grid-template-columns: repeat(2, 1fr); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>#hud{ inset: 14px 14px auto 14px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>#topRight{ top:14px; right:14px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>.hudCard{ min-width: 120px; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Animation doigt d'honneur (grosse et animÃ©e) */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>.middleFinger{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>position:absolute;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>font-size: 72px;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>z-index:90;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pointer-events:none;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>animation: fingerPop 1.15s cubic-bezier(.16,1,.3,1) forwards;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>text-shadow: 0 0 20px rgba(255,255,255,.55), 0 10px 34px rgba(0,0,0,.55);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>filter: drop-shadow(0 18px 26px rgba(0,0,0,.35));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>will-change: transform, opacity;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes fingerPop{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0%{ transform: translate(-50%,-50%) scale(0) rotate(var(--r, -16deg)); opacity:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>14%{ transform: translate(-50%,-50%) scale(1.55) rotate(calc(var(--r, -16deg) * -0.35)); opacity:1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>34%{ transform: translate(-50%,-50%) scale(1.25) rotate(calc(var(--r, -16deg) * 0.25)); opacity:1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>72%{ transform: translate(-50%,-50%) scale(1.32) rotate(calc(var(--r, -16deg) * -0.15)); opacity:1; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>100%{ transform: translate(-50%,-50%) scale(0.88) rotate(0deg); opacity:0; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/* Micro screen shake (feel de hit) */</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>#game.shake{ animation: shake .28s ease-out; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>@keyframes shake{</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>0%{ transform: translate3d(0,0,0); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>18%{ transform: translate3d(-3px, 2px,0) rotate(-0.2deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>38%{ transform: translate3d(3px, -2px,0) rotate(0.2deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>60%{ transform: translate3d(-2px, -1px,0) rotate(-0.1deg); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>100%{ transform: translate3d(0,0,0); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/style&gt;</p>
<p class="p1">&lt;/head&gt;</p>
<p class="p1">&lt;body&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;div id="game"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;canvas id="c"&gt;&lt;/canvas&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="hud"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hudCard" id="hudScore"&gt;&lt;div class="hudLabel"&gt;Score&lt;/div&gt;&lt;div class="hudValue" id="score"&gt;0&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hudCard" id="hudTime"&gt;&lt;div class="hudLabel"&gt;Temps&lt;/div&gt;&lt;div class="hudValue" id="time"&gt;60&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hudCard" id="hudHits"&gt;&lt;div class="hudLabel"&gt;Hits&lt;/div&gt;&lt;div class="hudValue" id="hits"&gt;0&lt;/div&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="topRight"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="restartGameBtn"&gt;â†» Restart&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="pauseBtn"&gt;â¸ Pause&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="soundBtn" title="Activer/DÃ©sactiver le son"&gt;ğŸ”Š Son&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="combo"&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="start"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="floaters" aria-hidden="true"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:6%; --dur:11s; --s:.9; --o:.22;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:18%; --dur:9s; --s:1.1; --o:.28; animation-delay:-2s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:33%; --dur:12s; --s:.8; --o:.18; animation-delay:-6s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:51%; --dur:10s; --s:1.25; --o:.26; animation-delay:-4s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:67%; --dur:13s; --s:.95; --o:.20; animation-delay:-8s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:82%; --dur:9.5s; --s:1.05; --o:.24; animation-delay:-5s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;span class="floater" style="left:92%; --dur:12.5s; --s:.85; --o:.18; animation-delay:-9s;"&gt;ğŸ·&lt;/span&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div style="display:flex;gap:12px;margin-bottom:20px;flex-wrap:wrap;justify-content:center;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;img src="./malo.jpg" alt="Malo" style="width:86px;height:86px;border-radius:50%;border:3px solid rgba(255,255,255,.30);object-fit:cover;box-shadow:0 10px 26px rgba(0,0,0,.45);transform:rotate(-2deg);"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;img src="./marie.jpg" alt="Marie" style="width:86px;height:86px;border-radius:50%;border:3px solid rgba(255,255,255,.30);object-fit:cover;box-shadow:0 10px 26px rgba(0,0,0,.45);transform:rotate(1deg);"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;img src="./nico.jpg" alt="Nico" style="width:86px;height:86px;border-radius:50%;border:3px solid rgba(255,255,255,.30);object-fit:cover;box-shadow:0 10px 26px rgba(0,0,0,.45);transform:rotate(-1deg);"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;img src="./valentine.jpg" alt="Valentine" style="width:86px;height:86px;border-radius:50%;border:3px solid rgba(255,255,255,.30);object-fit:cover;box-shadow:0 10px 26px rgba(0,0,0,.45);transform:rotate(2deg);"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h1 class="title"&gt;MALO'S REVENGE&lt;/h1&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="badge"&gt;ğŸª Cirque trash â€¢ ğŸ· ApÃ©ro â€¢ ğŸ–• Vengeance&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="hint" style="max-width:860px;padding:0 18px;margin-top:2px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>Bienvenue dans le cirque le plus trash de l'histoire. Malo veut sa revanche.&lt;br/&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>Lance des verres de vin sur tes potes qui dÃ©filent. Ils vont pleurer, te faire un doigt d'honneur â€” et toi tu vas kiffer.</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="panel"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="enterSection" style="display:flex;justify-content:center;margin:16px 0 10px;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;button class="btn" id="enterBtn" style="font-size:18px;padding:12px 32px;"&gt;ENTER&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;div id="diffSection" style="display:none;"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="grid"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="diff" data-diff="easy"&gt;&lt;div class="diffName"&gt;Easy&lt;/div&gt;&lt;div class="diffDesc"&gt;Cool &amp; smooth&lt;br/&gt;Pour s'Ã©chauffer.&lt;/div&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="diff" data-diff="medium"&gt;&lt;div class="diffName"&gt;Medium&lt;/div&gt;&lt;div class="diffDesc"&gt;Ã‡a commence Ã  piquer&lt;br/&gt;mais c'est gÃ©rable.&lt;/div&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="diff" data-diff="hard"&gt;&lt;div class="diffName"&gt;Hard&lt;/div&gt;&lt;div class="diffDesc"&gt;RÃ©flexes obligatoires&lt;br/&gt;sinon c'est honteux.&lt;/div&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;button class="diff" data-diff="insane"&gt;&lt;div class="diffName"&gt;Insane&lt;/div&gt;&lt;div class="diffDesc"&gt;Speedrun d'apÃ©ro&lt;br/&gt;Ã§a part en orbite.&lt;/div&gt;&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;div class="hint"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>Clique pour &lt;b&gt;lancer un verre de vin&lt;/b&gt; ğŸ· vers une tÃªte.&lt;br/&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>&lt;span class="kbd"&gt;P&lt;/span&gt; pause â€¢ &lt;span class="kbd"&gt;R&lt;/span&gt; restart â€¢ Le son dÃ©marre au premier clic.</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;div id="end"&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;h2 class="endTitle"&gt;FIN DE PARTIE&lt;/h2&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="endScore"&gt;Score : &lt;span id="finalScore"&gt;0&lt;/span&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;div class="endMsg" id="finalMsg"&gt;&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>&lt;button class="btn" id="restartBtn"&gt;â†» Rejouer&lt;/button&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>&lt;/div&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/div&gt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;script&gt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* CONFIG (PHOTOS)</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* - Mets les images au mÃªme niveau que index.html : malo.jpg, marie.jpg, nico.jpg, valentine.jpg</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* - Ou remplace par des URLs directes (ex: https://i.imgur.com/xxxx.jpg)</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const friends = [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ id: "malo", name: "Malo", img: "./malo.jpg" },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ id: "marie", name: "Marie", img: "./marie.jpg" },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ id: "ptitnico", name: "PtitNico", img: "./nico.jpg" },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ id: "valentine", name: "Valentine", img: "./valentine.jpg" },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// === IMAGE PRELOADING (fix bubbles vides) ===</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const imageCache = new Map();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function preloadImages(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const f of friends){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const img = new Image();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>img.src = f.img;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>img.onload = () =&gt; imageCache.set(f.id, img);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>imageCache.set(f.id, img); // set immediately to avoid race</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const diff = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>easy: <span class="Apple-converted-space">Â  </span>{ speed: 2.1, spawnMs: 1900, duration: 60, points: 10 },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>medium: { speed: 3.0, spawnMs: 1400, duration: 60, points: 15 },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>hard: <span class="Apple-converted-space">Â  </span>{ speed: 4.2, spawnMs: 1000, duration: 60, points: 25 },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>insane: { speed: 5.5, spawnMs: 780,<span class="Apple-converted-space">Â  </span>duration: 60, points: 40 },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// --- FEEL / JOUABILITÃ‰ (ajouts) ---</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Un arc lÃ©ger + une durÃ©e de vol adaptative = lancers plus naturels et qui atteignent vraiment la cible.</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const GRAVITY = 2600; // px/sÂ²</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const AIM_ASSIST_RADIUS = 120; // px (snap doux vers la tÃªte la plus proche)</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* HIT MESSAGES (TES PHRASES â€” CONSERVÃ‰ES)</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const hitMessagesByCharacter = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>malo: [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"C'est qui Ã§a ?",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Allez l'OM !",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"On va faire comme si rien ne s'Ã©tait passÃ©.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"T'es perdu ?",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"La vie est tellement injuste!",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// extras</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"FrÃ©rotâ€¦ c'Ã©tait pas ton jour.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Ok, j'avoueâ€¦ bien jouÃ©.",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// ajouts</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Encore ? Tu t'acharnes, champion.",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>marie: [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Je vais te gifler !",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Ah ouais ?.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Ca part en drame.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"T'as un problÃ¨me ?",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"On va te dÃ©gommer",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// extras</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Ã‡a va mal finir ",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Tu cherches ?",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â  Â  Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â  Â  Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ptitnico: [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Rastafarai !",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"On dirait un problÃ¨me.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"My Bad ",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Merci d'avoir tentÃ©.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Tu t'acharnes ?",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// extras</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"La vibe est cassÃ©e.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Pas trÃ¨s zen Ã§a.",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â  Â </span></p>
<p class="p2"><span class="Apple-converted-space">Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>valentine: [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Elle coÃ»te cher !",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"T'as vraiment cru que c'Ã©tait une bonne idÃ©e ?",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"C'Ã©tait hors budget, dÃ©solÃ©.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Tout le monde n'a pas le niveau.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Tu peux pas te le permettre.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// extras</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"Retourne en version gratuite.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>"DÃ©solÃ©e, c'est premium ici.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const missMessages = [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>"RatÃ©.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>"Mauvaise trajectoire, nul !",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>"Tu visais la tÃªte ?",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// ajouts (plus de variÃ©tÃ©)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>"Tu as lancÃ© avec le cÅ“ur.",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>"C'Ã©tait ambitieux. Trop.",</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const finalMessages = [</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ min: 0, <span class="Apple-converted-space">Â  </span>max: 9, <span class="Apple-converted-space">Â  </span>msg: "T'es vraiment nul, mÃªme Malo est dÃ©Ã§u." },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ min: 10,<span class="Apple-converted-space">Â  </span>max: 19,<span class="Apple-converted-space">Â  </span>msg: "Pas mal, mais Malo s'attendait Ã  mieux." },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ min: 20,<span class="Apple-converted-space">Â  </span>max: 29,<span class="Apple-converted-space">Â  </span>msg: "Bien jouÃ©, Malo commence Ã  pleurer." },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ min: 30,<span class="Apple-converted-space">Â  </span>max: 39,<span class="Apple-converted-space">Â  </span>msg: "Impressionnant, Malo est en larmes." },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>{ min: 40,<span class="Apple-converted-space">Â  </span>max: 9999, msg: "LÃ©gende vivante, Malo te respecte enfin." },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* DOM</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const gameEl = document.getElementById("game");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const canvas = document.getElementById("c");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const ctx = canvas.getContext("2d");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const startEl = document.getElementById("start");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const endEl = document.getElementById("end");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const restartBtn = document.getElementById("restartBtn");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const hudEl = document.getElementById("hud");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const topRightEl = document.getElementById("topRight");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const pauseBtn = document.getElementById("pauseBtn");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const soundBtn = document.getElementById("soundBtn");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const scoreEl = document.getElementById("score");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const timeEl = document.getElementById("time");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const hitsEl = document.getElementById("hits");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const comboEl = document.getElementById("combo");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const finalScoreEl = document.getElementById("finalScore");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const finalMsgEl = document.getElementById("finalMsg");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* CANVAS SIZE</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function resize(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dpr = Math.max(1, Math.min(2, window.devicePixelRatio || 1));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.width = Math.floor(window.innerWidth * dpr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.height = Math.floor(window.innerHeight * dpr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.width = window.innerWidth + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.height = window.innerHeight + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.setTransform(dpr, 0, 0, dpr, 0, 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener("resize", resize);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* HELPERS</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const clamp = (v, a, b) =&gt; Math.max(a, Math.min(b, v));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const rand = (a,b) =&gt; a + Math.random() * (b-a);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const pick = arr =&gt; arr[(Math.random() * arr.length) | 0];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawImageCover(ctx, img, x, y, w, h){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// center-crop like CSS object-fit: cover</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const iw = img.naturalWidth || img.width;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const ih = img.naturalHeight || img.height;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!iw || !ih) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const r = Math.max(w / iw, h / ih);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const nw = iw * r;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const nh = ih * r;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cx = x + (w - nw) / 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cy = y + (h - nh) / 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.drawImage(img, cx, cy, nw, nh);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function showCombo(n){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comboEl.textContent = `COMBO x${n}`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comboEl.classList.remove("show");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>void comboEl.offsetWidth;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comboEl.classList.add("show");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function showHitBubble(text, x, y, who){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// x,y are in viewport coordinates (same as our canvas logical coords)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const el = document.createElement("div");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.className = "hitBubble";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.innerHTML = `${escapeHtml(text)}&lt;small&gt;${escapeHtml(who)}&lt;/small&gt;`;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>gameEl.appendChild(el);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// initial position (to the right of the face)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.style.left = (x + 18) + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.style.top<span class="Apple-converted-space">Â  </span>= (y - 18) + "px";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// clamp inside viewport after we know its size</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const pad = 8;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const r = el.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let left = parseFloat(el.style.left);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let top = parseFloat(el.style.top);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// if it overflows on the right, flip to the left side</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (left + r.width &gt; window.innerWidth - pad){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>left = x - r.width - 18;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.transformOrigin = "right center";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrow", "left");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--flip", "1");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowSide", "right");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowLeft", "auto");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// clamp within viewport</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>left = clamp(left, pad, window.innerWidth - r.width - pad);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>top<span class="Apple-converted-space">Â  </span>= clamp(top,<span class="Apple-converted-space">Â  </span>pad, window.innerHeight - r.height - pad);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.style.left = left + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>el.style.top<span class="Apple-converted-space">Â  </span>= top + "px";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// If placed on left side, move arrow to right</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const placedLeft = (left &lt; x);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (placedLeft){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.transformOrigin = "right center";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowOnLeft", "0");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowX", "auto");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowR", "-5px");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrowL", "auto");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.setProperty("--arrow", "right");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.classList.add("leftSide");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>setTimeout(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.transition = "opacity .22s ease, transform .22s ease";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.opacity = "0";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>el.style.transform = "translateY(-6px) scale(.98)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>setTimeout(() =&gt; el.remove(), 240);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}, 1050);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function escapeHtml(str){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return String(str)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.replaceAll("&amp;", "&amp;amp;")</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.replaceAll("&lt;", "&amp;lt;")</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.replaceAll("&gt;", "&amp;gt;")</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.replaceAll('"', "&amp;quot;")</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>.replaceAll("'", "&amp;#39;");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* AUDIO (ENTRAINANT)</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let audio = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function initAudio(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (audio) return audio;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const AC = window.AudioContext || window.webkitAudioContext;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const ctxA = new AC();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const master = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>master.gain.value = 0.55;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const comp = ctxA.createDynamicsCompressor();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.threshold.value = -18;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.knee.value = 24;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.ratio.value = 6;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.attack.value = 0.003;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.release.value = 0.12;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>master.connect(comp);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>comp.connect(ctxA.destination);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// simple "color" filter for music</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const musicBus = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sfxBus = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicBus.gain.value = 0.9;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>sfxBus.gain.value = 1.0;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const musicLP = ctxA.createBiquadFilter();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicLP.type = "lowpass";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicLP.frequency.value = 9500;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicLP.Q.value = 0.7;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicBus.connect(musicLP);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>musicLP.connect(master);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>sfxBus.connect(master);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const state = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx: ctxA,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>enabled: true,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>bpm: 142,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>next: 0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>timer: null,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>step: 0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function now(){ return ctxA.currentTime; }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function tone(freq, t0, dur, type, gain, out=musicBus){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const o = ctxA.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const g = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>o.type = type;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>o.frequency.setValueAtTime(freq, t0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.setValueAtTime(0.0001, t0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(gain, t0 + 0.008);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>o.connect(g);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.connect(out);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>o.start(t0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>o.stop(t0 + dur + 0.02);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function noise(t0, dur, gain, hp=6000, out=sfxBus){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const len = Math.max(1, Math.floor(ctxA.sampleRate * dur));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const buf = ctxA.createBuffer(1, len, ctxA.sampleRate);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const d = buf.getChannelData(0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (let i=0;i&lt;len;i++) d[i] = Math.random()*2-1;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const src = ctxA.createBufferSource();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>src.buffer = buf;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const f = ctxA.createBiquadFilter();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>f.type = "highpass";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>f.frequency.setValueAtTime(hp, t0);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const g = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.setValueAtTime(0.0001, t0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(gain, t0 + 0.004);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(0.0001, t0 + dur);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>src.connect(f);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>f.connect(g);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.connect(out);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>src.start(t0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>src.stop(t0 + dur + 0.02);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// SFX: throw (glass whoosh + clink)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function sfxThrow(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!state.enabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const t = now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>noise(t, 0.05, 0.07, 1800, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(950, t, 0.06, "sine", 0.10, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(1550, t + 0.012, 0.05, "sine", 0.07, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// SFX: hit (thud + glass crackle)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function sfxHit(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!state.enabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const t = now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(90, t, 0.10, "sine", 0.22, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(2200, t + 0.02, 0.07, "square", 0.10, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>noise(t + 0.018, 0.10, 0.12, 1200, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function sfxMiss(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!state.enabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const t = now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(420, t, 0.08, "triangle", 0.07, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(330, t + 0.03, 0.09, "sine", 0.05, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// SFX: combo (petit cri de victoire)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function sfxCombo(n){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!state.enabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const t = now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const base = 520 + Math.min(420, n*18);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(base, t, 0.08, "square", 0.09, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>tone(base*1.33, t+0.04, 0.10, "triangle", 0.07, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>noise(t+0.02, 0.06, 0.06, 5200, sfxBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Music: upbeat electro/chiptune-ish groove</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Pattern: kick/snare/hat + bass + arp lead</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const kickSteps = new Set([0, 4, 8, 12, 14]);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const snrSteps<span class="Apple-converted-space">Â  </span>= new Set([4, 12]);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const hatSteps<span class="Apple-converted-space">Â  </span>= new Set([2, 6, 10, 14]);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const bassSeq = [110, 110, 98, 110, 130, 110, 98, 146]; // 8-step</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const arp = [523.25, 659.25, 783.99, 659.25]; // C5 E5 G5 E5</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function schedule(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!state.enabled) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const spb = 60 / state.bpm;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const stepDur = 0.25 * spb;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>while (state.next &lt; now() + 0.12){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const s = state.step % 16;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const t = state.next;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Kick</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (kickSteps.has(s)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// short pitch drop</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const o = ctxA.createOscillator();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const g = ctxA.createGain();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.type = "sine";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.frequency.setValueAtTime(150, t);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.frequency.exponentialRampToValueAtTime(46, t + 0.11);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>g.gain.setValueAtTime(0.0001, t);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(0.26, t + 0.005);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>g.gain.exponentialRampToValueAtTime(0.0001, t + 0.16);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.connect(g);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>g.connect(musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.start(t);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>o.stop(t + 0.18);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Snare</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (snrSteps.has(s)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>noise(t, 0.06, 0.10, 2000, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tone(190, t, 0.05, "triangle", 0.07, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Hat</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (hatSteps.has(s)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>noise(t, 0.03, 0.05, 7000, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Bass (on 8th steps)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (s % 2 === 0){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const f = bassSeq[(s/2) % bassSeq.length];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tone(f, t, 0.14, "sawtooth", 0.065, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// Arp lead (syncopated)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if ([1, 5, 9, 13].includes(s)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const f = arp[(s/4) | 0];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tone(f, t, 0.10, "square", 0.05, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>tone(f/2, t, 0.10, "triangle", 0.03, musicBus);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>state.step++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>state.next += stepDur;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function startMusic(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.next = now();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.step = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (state.timer) clearInterval(state.timer);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.timer = setInterval(schedule, 25);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>function stopMusic(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (state.timer) clearInterval(state.timer);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state.timer = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>audio = {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>state,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>startMusic,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>stopMusic,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sfxThrow,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sfxHit,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sfxMiss,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sfxCombo,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>async resume(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (ctxA.state === "suspended") {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>try { await ctxA.resume(); } catch(e) {}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>startMusic();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return audio;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>async function ensureAudio(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const a = initAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await a.resume();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return a;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function setSoundEnabled(on){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const a = initAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>a.state.enabled = on;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>soundBtn.textContent = on ? "ğŸ”Š Son" : "ğŸ”‡ Son";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* GAME STATE</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>let S = null;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function newState(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>return {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>running:false,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>paused:false,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>d:"easy",</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>score:0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>hits:0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>combo:0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>timeLeft:60,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>targets:[],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>projectiles:[],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>particles:[],</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>spawnT:0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>lastT:0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>timerId:null,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>pointer: { x: window.innerWidth/2, y: window.innerHeight/2, has:false },</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>};</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function reset(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S = newState();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>updateHud();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateHud(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>scoreEl.textContent = S.score;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>timeEl.textContent = S.timeLeft;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>hitsEl.textContent = S.hits;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* TARGETS</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function spawnTarget(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const f = friends[(Math.random()*friends.length)|0];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const size = 148; // bigger faces (jeu vidÃ©o vibe)</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const x = rand(20, window.innerWidth - size - 20);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const y = rand(90, window.innerHeight - size - 140);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const sp = diff[S.d].speed;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const vx = rand(-1, 1) * sp;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const vy = rand(-1, 1) * sp;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Use preloaded image from cache</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const img = imageCache.get(f.id);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!img || !img.complete) {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>console.warn(`Image for ${f.id} not ready, using fallback`);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.targets.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>f,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>x,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>y,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>vx,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>vy,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>size,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>img,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>wob: rand(0, Math.PI*2),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateTargets(dt){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const t of S.targets){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>t.wob += dt * 4.2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const wobble = Math.sin(t.wob) * 0.35;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>t.x += (t.vx + wobble) * dt * 60;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>t.y += (t.vy - wobble) * dt * 60;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (t.x &lt; 12){ t.x = 12; t.vx = Math.abs(t.vx); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (t.x &gt; window.innerWidth - t.size - 12){ t.x = window.innerWidth - t.size - 12; t.vx = -Math.abs(t.vx); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (t.y &lt; 80){ t.y = 80; t.vy = Math.abs(t.vy); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (t.y &gt; window.innerHeight - t.size - 120){ t.y = window.innerHeight - t.size - 120; t.vy = -Math.abs(t.vy); }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawTargets(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const t of S.targets){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const cx = t.x + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const cy = t.y + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const r = t.size/2;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// glow ring</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.shadowColor = "rgba(34,211,238,.35)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.shadowBlur = 22;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// outer ring</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.arc(cx, cy, r + 6, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = "rgba(255,255,255,.10)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fill();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// mask circle</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.arc(cx, cy, r, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.closePath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.clip();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (t.img.complete &amp;&amp; (t.img.naturalWidth || t.img.width)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>drawImageCover(ctx, t.img, t.x, t.y, t.size, t.size);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>} else {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// fallback placeholder</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.fillStyle = "rgba(255,255,255,.12)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.fillRect(t.x, t.y, t.size, t.size);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// subtle overlay</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const g = ctx.createLinearGradient(t.x, t.y, t.x + t.size, t.y + t.size);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.addColorStop(0, "rgba(0,0,0,.06)");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>g.addColorStop(1, "rgba(0,0,0,.22)");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = g;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillRect(t.x, t.y, t.size, t.size);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.restore();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// border</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.strokeStyle = "rgba(255,255,255,.68)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.lineWidth = 4;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.arc(cx, cy, r, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.stroke();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// name tag</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.shadowColor = "transparent";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = "rgba(0,0,0,.55)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tagW = ctx.measureText(t.f.name).width + 22;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tagX = cx - tagW/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tagY = t.y + t.size + 8;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>roundRect(ctx, tagX, tagY, tagW, 22, 10);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = "rgba(255,255,255,.92)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.font = "700 13px Oxanium";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.textAlign = "center";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.textBaseline = "middle";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillText(t.f.name, cx, tagY + 11);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function roundRect(ctx,x,y,w,h,r){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rr = Math.min(r, w/2, h/2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.moveTo(x+rr, y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arcTo(x+w, y, x+w, y+h, rr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arcTo(x+w, y+h, x, y+h, rr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arcTo(x, y+h, x, y, rr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arcTo(x, y, x+w, y, rr);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.closePath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* PROJECTILES (LANCER DE VERRE DE VIN â€” PRO)</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function throwWine(tx, ty){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Origine du lancer (bas centre)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const fromX = window.innerWidth / 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const fromY = window.innerHeight - 84;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// AIM ASSIST: si tu cliques proche d'une tÃªte, Ã§a "snap" doucement sur le centre</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let ax = tx, ay = ty;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let best = null;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let bestD = 1e9;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const t of S.targets){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const cx = t.x + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const cy = t.y + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const d = Math.hypot(ax - cx, ay - cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (d &lt; bestD){ bestD = d; best = {cx, cy}; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (best &amp;&amp; bestD &lt;= AIM_ASSIST_RADIUS){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ax = best.cx;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ay = best.cy;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dx = ax - fromX;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dy = ay - fromY;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dist = Math.max(1, Math.hypot(dx, dy));</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// DurÃ©e adaptative =&gt; le verre arrive vraiment Ã  l'endroit visÃ©</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const baseSpeed = 1550; // px/s (plus nerveux)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dur = clamp(dist / baseSpeed, 0.18, 0.62);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Balistique lÃ©gÃ¨re (arc) : vy initial compense la gravitÃ©</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const vx = dx / dur;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const vy = (dy - 0.5 * GRAVITY * dur * dur) / dur;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.projectiles.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>x: fromX,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>y: fromY,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>vx,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>vy,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>life: dur + 0.35,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>rot: rand(0, Math.PI*2),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>rvel: rand(-12, 12),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>sparkle: 1.0,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Petit flash de dÃ©part (feedback)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=0;i&lt;10;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>S.particles.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>x: fromX,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>y: fromY,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vx: rand(-220,220),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vy: rand(-380,-120),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>life: rand(0.12, 0.22),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>size: rand(2,4),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>col: `rgba(251,191,36,${rand(0.25,0.75)})`,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateProjectiles(dt){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=S.projectiles.length-1;i&gt;=0;i--){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const p = S.projectiles[i];</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// physics</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.vy += GRAVITY * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.x<span class="Apple-converted-space">Â  </span>+= p.vx * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.y<span class="Apple-converted-space">Â  </span>+= p.vy * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.rot += p.rvel * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.life -= dt;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// trail particles (plus sexy)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const tN = (S.d === "insane") ? 3 : 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (let k=0;k&lt;tN;k++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (Math.random() &lt; 0.95){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const wine = Math.random() &lt; 0.35;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.particles.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>x: p.x + rand(-6,6),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>y: p.y + rand(-6,6),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>vx: rand(-60,60),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>vy: rand(-60,60),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>life: rand(0.12, 0.22),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>size: rand(2,4),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>col: wine</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>? `rgba(251,113,133,${rand(0.25,0.65)})`<span class="Apple-converted-space">Â  </span>// rosÃ©-chaos</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  Â  </span>: `rgba(251,191,36,${rand(0.25,0.75)})`, // or du verre</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (p.life &lt;= 0 || p.x &lt; -120 || p.x &gt; window.innerWidth+120 || p.y &lt; -140 || p.y &gt; window.innerHeight+140){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>S.projectiles.splice(i,1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>// small miss feedback (sometimes)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (Math.random() &lt; 0.45){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>audio?.sfxMiss?.();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showHitBubble(pick(missMessages), clamp(p.x, 60, window.innerWidth-60), clamp(p.y, 80, window.innerHeight-120), "Miss");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawProjectiles(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.font = "44px system-ui";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.textAlign = "center";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.textBaseline = "middle";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const p of S.projectiles){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.translate(p.x, p.y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.rotate(p.rot);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.shadowColor = "rgba(251,191,36,.35)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.shadowBlur = 22;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillText("ğŸ·", 0, 0);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* PARTICLES</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function burst(x,y){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=0;i&lt;18;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>S.particles.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>x, y,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vx: rand(-260,260),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vy: rand(-320,200),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>life: rand(0.25, 0.45),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>size: rand(2,5),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>col: `rgba(34,211,238,${rand(0.25,0.8)})`,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=0;i&lt;10;i++){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>S.particles.push({</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>x, y,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vx: rand(-220,220),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>vy: rand(-220,220),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>life: rand(0.2, 0.35),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>size: rand(3,6),</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>col: `rgba(124,58,237,${rand(0.2,0.7)})`,</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function updateParticles(dt){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=S.particles.length-1;i&gt;=0;i--){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const p = S.particles[i];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.x += p.vx * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.y += p.vy * dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.vx *= Math.pow(0.08, dt); // friction</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.vy += 520 * dt; // gravity</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>p.life -= dt;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (p.life &lt;= 0) S.particles.splice(i,1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawParticles(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const p of S.particles){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Ring marker (vx=vy=0 and transparent color)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (p.vx === 0 &amp;&amp; p.vy === 0 &amp;&amp; p.col === "rgba(255,255,255,.0)"){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const t = clamp(p.life / 0.22, 0, 1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const rr = 18 + (1 - t) * 34;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.globalAlpha = t;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.strokeStyle = "rgba(34,211,238,.55)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.lineWidth = 3;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.arc(p.x, p.y, rr, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.strokeStyle = "rgba(124,58,237,.35)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.lineWidth = 6;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.arc(p.x, p.y, rr + 6, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>continue;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fillStyle = p.col;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.arc(p.x, p.y, p.size, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>ctx.fill();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* COLLISIONS</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function collide(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let pi=S.projectiles.length-1; pi&gt;=0; pi--){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>const p = S.projectiles[pi];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>for (let ti=S.targets.length-1; ti&gt;=0; ti--){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const t = S.targets[ti];</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const cx = t.x + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const cy = t.y + t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const r = t.size/2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>const d = Math.hypot(p.x - cx, p.y - cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>if (d &lt; r - 6){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// HIT</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.projectiles.splice(pi,1);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.targets.splice(ti,1);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.hits++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.combo++;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.score += diff[S.d].points + Math.min(40, (S.combo-1) * 2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>updateHud();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// effects</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>audio?.sfxHit?.();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>burst(cx, cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// micro shake + ring</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>gameEl.classList.remove("shake");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>void gameEl.offsetWidth;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>gameEl.classList.add("shake");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// ring visuel (quick)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>S.particles.push({ x: cx, y: cy, vx: 0, vy: 0, life: 0.22, size: 2, col: "rgba(255,255,255,.0)" });</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// Doigt d'honneur GROS et ANIMÃ‰ (feedback de hit)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const finger = document.createElement("div");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>finger.className = "middleFinger";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>finger.textContent = "ğŸ–•";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>finger.style.left = cx + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>finger.style.top = cy + "px";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>finger.style.setProperty("--r", (rand(-22, 22)).toFixed(1) + "deg");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>gameEl.appendChild(finger);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>setTimeout(() =&gt; finger.remove(), 1200);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>// message near face (clamped â€” won't go off-screen)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>const msg = pick(hitMessagesByCharacter[t.f.id] || ["TouchÃ© !"]);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>showHitBubble(msg, cx + r + 8, cy, t.f.name);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>if (S.combo === 3 || S.combo === 5 || (S.combo &gt; 5 &amp;&amp; S.combo % 5 === 0)){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>showCombo(S.combo);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  Â  </span>audio?.sfxCombo?.(S.combo);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  Â  </span>break;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* LOOP</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function drawAim(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// Crosshair viseur (optionnel mais sympa)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.pointer.has) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.save();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.strokeStyle = "rgba(251,191,36,.55)";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.lineWidth = 2;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cx = S.pointer.x;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const cy = S.pointer.y;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const r = 18;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.arc(cx, cy, r, 0, Math.PI*2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// crosshair lines</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.beginPath();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.moveTo(cx - r - 8, cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.lineTo(cx - r - 2, cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.moveTo(cx + r + 2, cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.lineTo(cx + r + 8, cy);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.moveTo(cx, cy - r - 8);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.lineTo(cx, cy - r - 2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.moveTo(cx, cy + r + 2);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.lineTo(cx, cy + r + 8);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.stroke();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.restore();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function loop(ts){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.running) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.lastT) S.lastT = ts;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const dt = clamp((ts - S.lastT) / 1000, 0, 0.033);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.lastT = ts;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.paused){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>S.spawnT += dt * 1000;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (S.spawnT &gt;= diff[S.d].spawnMs){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>S.spawnT = 0;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  Â  </span>spawnTarget();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateTargets(dt);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateProjectiles(dt);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateParticles(dt);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>collide();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// draw</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.clearRect(0,0,window.innerWidth, window.innerHeight);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// parallax glow vignette</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const vg = ctx.createRadialGradient(window.innerWidth*0.5, window.innerHeight*0.45, 120, window.innerWidth*0.5, window.innerHeight*0.5, Math.max(window.innerWidth, window.innerHeight));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>vg.addColorStop(0, "rgba(255,255,255,.03)");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>vg.addColorStop(1, "rgba(0,0,0,.28)");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillStyle = vg;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>ctx.fillRect(0,0,window.innerWidth, window.innerHeight);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>drawParticles();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>drawTargets();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>drawProjectiles();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>drawAim();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>requestAnimationFrame(loop);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* TIMER</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function startTimer(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (S.timerId) clearInterval(S.timerId);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.timerId = setInterval(() =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (!S.running || S.paused) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>S.timeLeft--;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>updateHud();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (S.timeLeft &lt;= 0) endGame();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}, 1000);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* START / END</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>async function startGame(which){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>reset();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.d = which;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.timeLeft = diff[which].duration;</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await ensureAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>initAudio().startMusic();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>startEl.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>endEl.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.display = "block";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>hudEl.style.display = "flex";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>topRightEl.style.display = "flex";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.running = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.paused = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pauseBtn.textContent = "â¸ Pause";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>// spawn initial targets</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (let i=0;i&lt;4;i++) spawnTarget();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>startTimer();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>requestAnimationFrame(loop);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function endGame(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.running = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (S.timerId) clearInterval(S.timerId);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>initAudio().stopMusic();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>canvas.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>hudEl.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>topRightEl.style.display = "none";</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>finalScoreEl.textContent = S.score;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>let msg = finalMessages[0].msg;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>for (const m of finalMessages){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (S.score &gt;= m.min &amp;&amp; S.score &lt;= m.max){ msg = m.msg; break; }</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>finalMsgEl.textContent = msg;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>endEl.style.display = "flex";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function restart(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>endEl.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>startEl.style.display = "flex";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>function togglePause(){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.running) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.paused = !S.paused;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>pauseBtn.textContent = S.paused ? "â–¶ Reprendre" : "â¸ Pause";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* INPUTS</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p2"><span class="Apple-converted-space">Â Â  Â </span></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// Suivi du viseur (plus jouable)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas.addEventListener("pointermove", (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.pointer.x = e.clientX - rect.left;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.pointer.y = e.clientY - rect.top;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.pointer.has = true;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas.addEventListener("pointerleave", () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>S.pointer.has = false;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>canvas.addEventListener("click", async (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (!S.running || S.paused) return;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await ensureAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>initAudio().sfxThrow();</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const rect = canvas.getBoundingClientRect();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const x = e.clientX - rect.left;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const y = e.clientY - rect.top;</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>throwWine(x, y);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>// === ENTER BUTTON LOGIC ===</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const enterBtn = document.getElementById("enterBtn");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const enterSection = document.getElementById("enterSection");</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>const diffSection = document.getElementById("diffSection");</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>if (enterBtn &amp;&amp; enterSection &amp;&amp; diffSection){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>enterBtn.addEventListener("click", async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Warm up audio (helps iOS)</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>try { await ensureAudio(); } catch(e) { console.warn("Audio warmup failed", e); }</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>// Hide ENTER, show difficulty buttons</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>enterSection.style.display = "none";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>diffSection.style.display = "block";</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>});</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>}</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>document.querySelectorAll(".diff").forEach(btn =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>btn.addEventListener("click", () =&gt; startGame(btn.dataset.diff));</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>restartBtn.addEventListener("click", restart);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>pauseBtn.addEventListener("click", togglePause);</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>soundBtn.addEventListener("click", async () =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>await ensureAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const a = initAudio();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>setSoundEnabled(!a.state.enabled);</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>window.addEventListener("keydown", (e) =&gt; {</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>const k = e.key.toLowerCase();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (k === "p") togglePause();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>if (k === "r"){</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>if (S.running) endGame();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  Â  </span>restart();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  Â  </span>}</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>});</p>
<p class="p2"><br></p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>/****</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>* INIT</p>
<p class="p1"><span class="Apple-converted-space">Â Â  Â  </span>****/</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>preloadImages();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>reset();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>resize();</p>
<p class="p1"><span class="Apple-converted-space">Â  Â  </span>setSoundEnabled(true);</p>
<p class="p1"><span class="Apple-converted-space">Â  </span>&lt;/script&gt;</p>
<p class="p1">&lt;/body&gt;</p>
<p class="p1">&lt;/html&gt;</p>
</body>
</html>
