<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>üé™ Malo's Revenge üé™</title>
  <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&display=swap" rel="stylesheet">
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }
    body {
      font-family: 'Orbitron', sans-serif;
      background: linear-gradient(135deg, #1a0033 0%, #330066 50%, #660099 100%);
      color: #fff;
      overflow: hidden;
      height: 100vh;
    }
    #startScreen {
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      padding: 20px;
      background: radial-gradient(circle, rgba(255,0,150,0.2) 0%, transparent 70%);
    }
    #startScreen h1 {
      font-size: 4rem;
      font-weight: 900;
      margin-bottom: 30px;
      text-shadow: 0 0 20px #ff0099, 0 0 40px #ff0099;
      animation: pulse 2s infinite;
    }
    #startScreen p {
      font-size: 1.3rem;
      line-height: 1.8;
      margin-bottom: 40px;
      max-width: 700px;
      text-shadow: 0 2px 10px rgba(0,0,0,0.5);
    }
    @keyframes pulse {
      0%, 100% { transform: scale(1); }
      50% { transform: scale(1.05); }
    }
    .enter-btn {
      padding: 20px 60px;
      font-size: 1.8rem;
      font-weight: 700;
      background: linear-gradient(45deg, #ff0099, #ff6600);
      border: none;
      border-radius: 50px;
      color: #fff;
      cursor: pointer;
      text-transform: uppercase;
      box-shadow: 0 10px 30px rgba(255,0,153,0.5);
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }
    .enter-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(255,0,153,0.7);
    }
    #difficultyScreen {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      padding: 20px;
    }
    #difficultyScreen h2 {
      font-size: 3rem;
      margin-bottom: 50px;
      text-shadow: 0 0 15px #00ffff;
    }
    .difficulty-buttons {
      display: flex;
      gap: 30px;
      flex-wrap: wrap;
      justify-content: center;
    }
    .difficulty-btn {
      padding: 20px 40px;
      font-size: 1.5rem;
      font-weight: 700;
      border: 3px solid #fff;
      border-radius: 15px;
      background: rgba(255,255,255,0.1);
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
      text-transform: uppercase;
    }
    .difficulty-btn:hover {
      background: rgba(255,255,255,0.3);
      transform: scale(1.1);
    }
    #gameCanvas {
      display: none;
      background: linear-gradient(180deg, #0a0015 0%, #1a0033 100%);
      cursor: crosshair;
    }
    #gameUI {
      position: absolute;
      top: 20px;
      left: 20px;
      font-size: 1.5rem;
      z-index: 10;
      text-shadow: 0 2px 5px rgba(0,0,0,0.8);
    }
    #gameUI div {
      margin-bottom: 10px;
    }
    #controls {
      position: absolute;
      top: 20px;
      right: 20px;
      z-index: 10;
      display: none;
    }
    .control-btn {
      padding: 10px 20px;
      margin-left: 10px;
      font-size: 1rem;
      font-weight: 700;
      background: rgba(255,255,255,0.2);
      border: 2px solid #fff;
      border-radius: 10px;
      color: #fff;
      cursor: pointer;
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }
    .control-btn:hover {
      background: rgba(255,255,255,0.4);
    }
    #endScreen {
      display: none;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      height: 100vh;
      text-align: center;
      padding: 20px;
    }
    #endScreen h2 {
      font-size: 3.5rem;
      margin-bottom: 30px;
      text-shadow: 0 0 20px #ffff00;
    }
    #endScreen p {
      font-size: 1.8rem;
      margin-bottom: 20px;
    }
    #finalMessage {
      font-size: 1.5rem;
      margin: 30px 0;
      padding: 20px;
      background: rgba(255,255,255,0.1);
      border-radius: 15px;
      max-width: 600px;
    }
    .restart-btn {
      padding: 20px 50px;
      font-size: 1.5rem;
      font-weight: 700;
      background: linear-gradient(45deg, #00ff00, #00cc00);
      border: none;
      border-radius: 50px;
      color: #fff;
      cursor: pointer;
      text-transform: uppercase;
      box-shadow: 0 10px 30px rgba(0,255,0,0.5);
      transition: all 0.3s ease;
      font-family: 'Orbitron', sans-serif;
    }
    .restart-btn:hover {
      transform: translateY(-5px);
      box-shadow: 0 15px 40px rgba(0,255,0,0.7);
    }
  </style>
</head>
<body>
  <div id="startScreen">
    <h1>üé™ Malo's Revenge üé™</h1>
    <p>
      Bienvenue dans le cirque le plus trash de l'histoire ! <br>
      Malo en a marre. Il veut sa revanche. <br>
      Lance des bouteilles de vin sur tes potes qui d√©filent. <br>
      Ils vont pleurer, te faire un doigt d'honneur, et toi tu vas kiffer. <br>
      Choisis ton niveau de difficult√© et que le massacre commence ! üç∑üíÄ
    </p>
    <button class="enter-btn" onclick="showDifficulty()">ENTER</button>
  </div>

  <div id="difficultyScreen">
    <h2>Choisis ton niveau de difficult√©</h2>
    <div class="difficulty-buttons">
      <button class="difficulty-btn" onclick="startGame('easy')">üòá Facile</button>
      <button class="difficulty-btn" onclick="startGame('medium')">üòà Moyen</button>
      <button class="difficulty-btn" onclick="startGame('hard')">üíÄ Difficile</button>
    </div>
  </div>

  <canvas id="gameCanvas"></canvas>

  <div id="gameUI">
    <div>Score: <span id="score">0</span></div>
    <div>Temps: <span id="timer">60</span>s</div>
  </div>

  <div id="controls">
    <button class="control-btn" onclick="togglePause()">‚è∏Ô∏è Pause</button>
    <button class="control-btn" onclick="restartGame()">üîÑ Restart</button>
  </div>

  <div id="endScreen">
    <h2>üéâ Game Over üéâ</h2>
    <p>Score final: <span id="finalScore">0</span></p>
    <div id="finalMessage"></div>
    <button class="restart-btn" onclick="restartGame()">Rejouer</button>
  </div>

  <script>
    const canvas = document.getElementById('gameCanvas');
    const ctx = canvas.getContext('2d');
    canvas.width = window.innerWidth;
    canvas.height = window.innerHeight;

    const friends = [
      { name: 'malo', img: 'https://i.imgur.com/Ks0Iqxu.jpg' },
      { name: 'marie', img: 'https://i.imgur.com/Ks0Iqxu.jpg' },
      { name: 'ptitnico', img: 'https://i.imgur.com/Ks0Iqxu.jpg' },
      { name: 'valentine', img: 'https://i.imgur.com/Ks0Iqxu.jpg' }
    ];

    const hitMessages = {
      malo: [
        "C'est qui √ßa ?",
        "On t'a d√©j√† vu quelque part ?",
        "On va faire comme si rien ne s'√©tait pass√©.",
        "T'es perdu fr√©rot ?",
        "La vie est injuste!",
        "Fr√©rot‚Ä¶ c'√©tait pas ton jour.",
        "Ok, j'avoue‚Ä¶ bien jou√©.",
        "Encore ? Tu t'acharnes, champion.",
        "A√Øe. M√™me le clown a eu mal.",
      ],
      marie: [
        "Je vais te gifler !",
        "PAS d'accord.",
        "Oups, √ßa part en drame.",
        "T'as un probl√®me ?",
        "On va te d√©gommer",
        "√áa va finir au tribunal.",
        "C'est officiel: tu cherches.",
        "Je te pr√©viens‚Ä¶ √ßa va partir.",
        "Ok. L√† c'est personnel.",
      ],
      ptitnico: [
        "Rastafarai !",
        "On dirait un probl√®me.",
        "Bad vibes ",
        "Merci d'avoir tent√©.",
        "Tu t'acharnes ?",
        "La vibe est cass√©e.",
        "C'est pas tr√®s zen √ßa.",
        "Pas tr√®s peace & love √ßa‚Ä¶",
        "Tu brises l'harmonie cosmique.",
      ],
      valentine: [
        "Elle co√ªte cher !",
        "T'as vraiment cru que c'√©tait une bonne id√©e ?",
        "C'√©tait hors budget, d√©sol√©.",
        "Tout le monde n'a pas le niveau.",
        "Tu peux pas te le permettre.",
        "Retourne en version gratuite.",
        "D√©sol√©e, c'est premium ici.",
        "Ajoute au panier: 1 humiliation.",
        "√áa va te co√ªter une excuse.",
      ]
    };

    const finalMessages = [
      { min: 0, max: 5, msg: "üò¨ Euh‚Ä¶ t'as essay√© au moins ?" },
      { min: 6, max: 15, msg: "ü§∑ Bon, c'est un d√©but. Mais vraiment un d√©but." },
      { min: 16, max: 30, msg: "üëç Pas mal ! T'as compris le principe." },
      { min: 31, max: 50, msg: "üî• Solide ! T'es chaud bouillant !" },
      { min: 51, max: 999, msg: "üëë L√âGENDE ! T'es le roi du cirque !" }
    ];

    let gameState = {
      score: 0,
      timeLeft: 60,
      isPaused: false,
      isRunning: false,
      difficulty: 'medium',
      targets: [],
      bottles: [],
      particles: []
    };

    let images = {};
    let imagesLoaded = 0;

    friends.forEach(friend => {
      const img = new Image();
      img.crossOrigin = "anonymous";
      img.onload = () => {
        imagesLoaded++;
        if (imagesLoaded === friends.length) {
          console.log('Toutes les images sont charg√©es');
        }
      };
      img.onerror = () => {
        console.error('Erreur de chargement:', friend.name);
        imagesLoaded++;
      };
      img.src = friend.img;
      images[friend.name] = img;
    });

    function showDifficulty() {
      document.getElementById('startScreen').style.display = 'none';
      document.getElementById('difficultyScreen').style.display = 'flex';
    }

    function startGame(difficulty) {
      gameState.difficulty = difficulty;
      gameState.score = 0;
      gameState.timeLeft = 60;
      gameState.isPaused = false;
      gameState.isRunning = true;
      gameState.targets = [];
      gameState.bottles = [];
      gameState.particles = [];

      document.getElementById('difficultyScreen').style.display = 'none';
      document.getElementById('endScreen').style.display = 'none';
      document.getElementById('gameCanvas').style.display = 'block';
      document.getElementById('controls').style.display = 'block';

      updateUI();
      gameLoop();
      startTimer();
      spawnTargets();
    }

    function spawnTargets() {
      if (!gameState.isRunning) return;

      const delays = { easy: 2000, medium: 1500, hard: 1000 };
      const delay = delays[gameState.difficulty];

      const friend = friends[Math.floor(Math.random() * friends.length)];
      const speeds = { easy: 2, medium: 3.5, hard: 5 };
      const speed = speeds[gameState.difficulty];

      const target = {
        x: -100,
        y: Math.random() * (canvas.height - 150) + 50,
        width: 80,
        height: 80,
        speed: speed,
        friend: friend,
        hit: false,
        hitTime: 0,
        message: ''
      };

      gameState.targets.push(target);

      setTimeout(() => spawnTargets(), delay);
    }

    function startTimer() {
      const timerInterval = setInterval(() => {
        if (!gameState.isRunning || gameState.isPaused) return;

        gameState.timeLeft--;
        updateUI();

        if (gameState.timeLeft <= 0) {
          clearInterval(timerInterval);
          endGame();
        }
      }, 1000);
    }

    function updateUI() {
      document.getElementById('score').textContent = gameState.score;
      document.getElementById('timer').textContent = gameState.timeLeft;
    }

    canvas.addEventListener('click', (e) => {
      if (!gameState.isRunning || gameState.isPaused) return;

      const rect = canvas.getBoundingClientRect();
      const clickX = e.clientX - rect.left;
      const clickY = e.clientY - rect.top;

      const bottle = {
        x: clickX,
        y: canvas.height,
        targetY: clickY,
        speed: 15
      };

      gameState.bottles.push(bottle);

      playSound('throw');
    });

    function gameLoop() {
      if (!gameState.isRunning) return;

      ctx.clearRect(0, 0, canvas.width, canvas.height);

      if (!gameState.isPaused) {
        updateTargets();
        updateBottles();
        updateParticles();
      }

      drawTargets();
      drawBottles();
      drawParticles();

      requestAnimationFrame(gameLoop);
    }

    function updateTargets() {
      gameState.targets = gameState.targets.filter(target => {
        if (!target.hit) {
          target.x += target.speed;
          return target.x < canvas.width + 100;
        } else {
          return Date.now() - target.hitTime < 1000;
        }
      });
    }

    function updateBottles() {
      gameState.bottles = gameState.bottles.filter(bottle => {
        bottle.y -= bottle.speed;

        gameState.targets.forEach(target => {
          if (!target.hit &&
              bottle.x > target.x &&
              bottle.x < target.x + target.width &&
              bottle.y > target.y &&
              bottle.y < target.y + target.height) {

            target.hit = true;
            target.hitTime = Date.now();
            target.message = hitMessages[target.friend.name][
              Math.floor(Math.random() * hitMessages[target.friend.name].length)
            ];

            gameState.score += 10;
            updateUI();
            createParticles(target.x + target.width / 2, target.y + target.height / 2);
            playSound('hit');
          }
        });

        return bottle.y > 0;
      });
    }

    function updateParticles() {
      gameState.particles = gameState.particles.filter(p => {
        p.x += p.vx;
        p.y += p.vy;
        p.life--;
        return p.life > 0;
      });
    }

    function drawTargets() {
      gameState.targets.forEach(target => {
        if (target.hit) {
          ctx.save();
          ctx.globalAlpha = 0.5;
          ctx.filter = 'grayscale(100%)';
        }

        if (images[target.friend.name] && images[target.friend.name].complete) {
          ctx.drawImage(images[target.friend.name], target.x, target.y, target.width, target.height);
        } else {
          ctx.fillStyle = '#ff0099';
          ctx.fillRect(target.x, target.y, target.width, target.height);
        }

        if (target.hit) {
          ctx.restore();
          ctx.font = '16px Orbitron';
          ctx.fillStyle = '#ffff00';
          ctx.textAlign = 'center';
          ctx.fillText(target.message, target.x + target.width / 2, target.y - 10);
          ctx.fillText('üñïüò≠', target.x + target.width / 2, target.y + target.height + 25);
        }
      });
    }

    function drawBottles() {
      gameState.bottles.forEach(bottle => {
        ctx.font = '30px Arial';
        ctx.fillText('üç∑', bottle.x - 15, bottle.y);
      });
    }

    function drawParticles() {
      gameState.particles.forEach(p => {
        ctx.fillStyle = p.color;
        ctx.globalAlpha = p.life / 30;
        ctx.fillRect(p.x, p.y, 5, 5);
        ctx.globalAlpha = 1;
      });
    }

    function createParticles(x, y) {
      for (let i = 0; i < 20; i++) {
        gameState.particles.push({
          x: x,
          y: y,
          vx: (Math.random() - 0.5) * 10,
          vy: (Math.random() - 0.5) * 10,
          life: 30,
          color: ['#ff0099', '#00ffff', '#ffff00', '#ff6600'][Math.floor(Math.random() * 4)]
        });
      }
    }

    function playSound(type) {
      const audioContext = new (window.AudioContext || window.webkitAudioContext)();
      const oscillator = audioContext.createOscillator();
      const gainNode = audioContext.createGain();

      oscillator.connect(gainNode);
      gainNode.connect(audioContext.destination);

      if (type === 'throw') {
        oscillator.frequency.value = 400;
        gainNode.gain.setValueAtTime(0.3, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.1);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.1);
      } else if (type === 'hit') {
        oscillator.frequency.value = 800;
        gainNode.gain.setValueAtTime(0.5, audioContext.currentTime);
        gainNode.gain.exponentialRampToValueAtTime(0.01, audioContext.currentTime + 0.2);
        oscillator.start(audioContext.currentTime);
        oscillator.stop(audioContext.currentTime + 0.2);
      }
    }

    function togglePause() {
      gameState.isPaused = !gameState.isPaused;
    }

    function restartGame() {
      startGame(gameState.difficulty);
    }

    function endGame() {
      gameState.isRunning = false;
      document.getElementById('gameCanvas').style.display = 'none';
      document.getElementById('controls').style.display = 'none';
      document.getElementById('endScreen').style.display = 'flex';
      document.getElementById('finalScore').textContent = gameState.score;

      const message = finalMessages.find(m => 
        gameState.score >= m.min && gameState.score <= m.max
      );
      document.getElementById('finalMessage').textContent = message ? message.msg : "üéâ Incroyable !";
    }

    window.addEventListener('resize', () => {
      canvas.width = window.innerWidth;
      canvas.height = window.innerHeight;
    });
  </script>
</body>
</html>